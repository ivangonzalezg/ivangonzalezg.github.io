# Long cache for static images
<FilesMatch "\.(jpg|jpeg|png|gif|webp)$">
    Header set Cache-Control "max-age=31536000"
</FilesMatch>

# Prevent directory listing
Options -Indexes

# Enable rewrite engine
RewriteEngine On
RewriteBase /

# Default everything (except /v1 and /v2) to v2
RewriteCond %{REQUEST_URI} !^/v1/
RewriteCond %{REQUEST_URI} !^/v2/
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /v2/$1 [L]
RewriteRule ^$ /v2/ [L]

# Keep direct access to version 1
RewriteRule ^v1/?$ /v1/index.html [L]
RewriteRule ^v1/(.*)$ /v1/$1 [L]

# Serve Vite assets and routes for v2 from dist/
RewriteCond %{REQUEST_URI} ^/v2/(.*)$
RewriteCond %{DOCUMENT_ROOT}/v2/dist/%1 -f
RewriteRule ^v2/(.*)$ /v2/dist/$1 [L]
RewriteCond %{REQUEST_URI} ^/v2/(.*)$
RewriteCond %{DOCUMENT_ROOT}/v2/dist/%1 -d
RewriteRule ^v2/(.*)$ /v2/dist/$1/ [L]
RewriteCond %{REQUEST_URI} ^/v2
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^v2/?.*$ /v2/dist/index.html [L]

# Block deployment state file
<Files ".ftp-deploy-sync-state.json">
    Order Allow,Deny
    Deny from all
</Files>
